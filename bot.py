"""
Telegram Bot for Sinich
Hosted on Bothost.org
"""

import logging
import os
from telegram import Update
from telegram.ext import Application, CommandHandler, MessageHandler, filters, ContextTypes

# ============================================
# –ù–ê–°–¢–†–û–ô–ö–ê –õ–û–ì–ì–ò–†–û–í–ê–ù–ò–Ø
# ============================================
logging.basicConfig(
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    level=logging.INFO
)
logger = logging.getLogger(__name__)

# ============================================
# –ü–û–õ–£–ß–ï–ù–ò–ï –¢–û–ö–ï–ù–ê
# ============================================
def get_bot_token():
    """–ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ —Ä–∞–∑–Ω—ã–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏"""
    
    # –°–ø–æ—Å–æ–± 1: –ò–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (–¥–ª—è Bothost/Render)
    token = os.environ.get('BOT_TOKEN')
    if token:
        logger.info("–¢–æ–∫–µ–Ω –ø–æ–ª—É—á–µ–Ω –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è")
        return token
    
    # –°–ø–æ—Å–æ–± 2: –ò–∑ —Ñ–∞–π–ª–∞ token.txt (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
    try:
        with open('token.txt', 'r') as f:
            token = f.read().strip()
            if token and len(token) > 20:  # –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
                logger.info("–¢–æ–∫–µ–Ω –ø–æ–ª—É—á–µ–Ω –∏–∑ —Ñ–∞–π–ª–∞ token.txt")
                return token
    except FileNotFoundError:
        pass
    
    # –°–ø–æ—Å–æ–± 3: –ü—Ä—è–º–æ –≤ –∫–æ–¥–µ (–¢–û–õ–¨–ö–û –î–õ–Ø –¢–ï–°–¢–û–í!)
    # –í–ê–ñ–ù–û: –ù–ò–ö–û–ì–î–ê –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥ —Å —Ä–µ–∞–ª—å–Ω—ã–º —Ç–æ–∫–µ–Ω–æ–º –≤ GitHub!
    test_token = "–í–ê–®_–¢–û–ö–ï–ù_–ó–î–ï–°–¨"  # <-- –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Å–≤–æ–π –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞
    if test_token != "–í–ê–®_–¢–û–ö–ï–ù_–ó–î–ï–°–¨":
        logger.info("–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–µ—Å—Ç–æ–≤—ã–π —Ç–æ–∫–µ–Ω –∏–∑ –∫–æ–¥–∞")
        return test_token
    
    # –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω
    logger.error("‚ùå –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω!")
    return None

# ============================================
# –ö–û–ú–ê–ù–î–´ –ë–û–¢–ê
# ============================================

async def start_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start"""
    user = update.effective_user
    welcome_text = f"""
üéÆ –ü—Ä–∏–≤–µ—Ç, {user.first_name}! –Ø —Ç–≤–æ–π –∏–≥—Ä–æ–≤–æ–π –ø–æ–º–æ—â–Ω–∏–∫!

‚ú® –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
/start - —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ
/hello - –ø–æ–∑–¥–æ—Ä–æ–≤–∞—Ç—å—Å—è
/help - –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã
/games - –∏–≥—Ä–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
/info - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–æ—Ç–µ

üìå –ü–∏—à–∏ –º–Ω–µ —á—Ç–æ —É–≥–æ–¥–Ω–æ, –∏ —è –æ—Ç–≤–µ—á—É!
    """
    await update.message.reply_text(welcome_text)

async def hello_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /hello"""
    responses = [
        "–ü—Ä–∏–≤–µ—Ç, –ü–æ–ª–∏–∫! –ì–æ –∏–≥—Ä–∞—Ç—å? üéÆ",
        "–ó–¥–∞—Ä–æ–≤–∞, –¥—Ä—É–≥! –ö–∞–∫ –¥–µ–ª–∏—à–∫–∏? üòé",
        "–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é! –ß–µ–º –∑–∞–π–º–µ–º—Å—è —Å–µ–≥–æ–¥–Ω—è? ‚ú®",
        "–ô–æ—É! –†–∞–¥ —Ç–µ–±—è –≤–∏–¥–µ—Ç—å! üéØ",
        "–ü—Ä–∏–≤–µ—Ç! –ì–æ—Ç–æ–≤ –∫ –Ω–æ–≤—ã–º –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è–º? üèÜ"
    ]
    import random
    await update.message.reply_text(random.choice(responses))

async def help_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /help"""
    help_text = """
ü§ñ **–ö–û–ú–ê–ù–î–´ –ë–û–¢–ê:**

üéÆ **–û—Å–Ω–æ–≤–Ω—ã–µ:**
/start - –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É
/hello - –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
/help - –≠—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞
/info - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–æ—Ç–µ

üéØ **–ò–≥—Ä–æ–≤—ã–µ (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ):**
/games - –ò–≥—Ä–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

üõí **–ë—ã—Ç–æ–≤—ã–µ (—Å–∫–æ—Ä–æ):**
/shopping - –°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫
/todo - –°–ø–∏—Å–æ–∫ –¥–µ–ª
/remind - –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è

üí¨ **–ü—Ä–æ—á–µ–µ:**
–ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ - –∏ —è –æ—Ç–≤–µ—á—É!
    """
    await update.message.reply_text(help_text)

async def info_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /info"""
    info_text = """
üìä **–ò–ù–§–û–†–ú–ê–¶–ò–Ø –û –ë–û–¢–ï:**
‚Ä¢ –•–æ—Å—Ç–∏–Ω–≥: Bothost.org üöÄ
‚Ä¢ –°—Ç–∞—Ç—É—Å: –†–∞–±–æ—Ç–∞–µ—Ç ‚úÖ
‚Ä¢ –í–ª–∞–¥–µ–ª–µ—Ü: Sinich (–ü–æ–ª–∏–∫) üéÆ
‚Ä¢ –í–µ—Ä—Å–∏—è: 1.0

üìà **–§—É–Ω–∫—Ü–∏–∏:**
‚Ä¢ –ò–≥—Ä–æ–≤—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
‚Ä¢ –ë—ã—Ç–æ–≤—ã–µ —Å–ø–∏—Å–∫–∏
‚Ä¢ –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±—â–µ–Ω–∏–µ

‚öôÔ∏è **–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:**
‚Ä¢ Python + python-telegram-bot
‚Ä¢ –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
    """
    await update.message.reply_text(info_text)

async def games_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /games"""
    games_text = """
üéÆ **–ò–ì–†–û–í–´–ï –§–£–ù–ö–¶–ò–ò (–°–ö–û–†–û):**

1. **–¢—Ä–µ–∫–µ—Ä –ø—Ä–æ–≥—Ä–µ—Å—Å–∞** - —É—Ä–æ–≤–Ω–∏, –∫–≤–µ—Å—Ç—ã
2. **–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –∏–≥—Ä** - —Å –¥—Ä—É–∑—å—è–º–∏
3. **–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è** - –∏–≤–µ–Ω—Ç—ã, —Ä–µ–π–¥—ã

üìù –ß—Ç–æ–±—ã –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é:
–ù–∞–ø–∏—à–∏ "—Ö–æ—á—É —Ñ—É–Ω–∫—Ü–∏—é [–æ–ø–∏—Å–∞–Ω–∏–µ]"
    """
    await update.message.reply_text(games_text)

async def echo_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ–±—ã—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π"""
    user_message = update.message.text
    
    # –ü—Ä–æ—Å—Ç—ã–µ –æ—Ç–≤–µ—Ç—ã –Ω–∞ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ñ—Ä–∞–∑—ã
    responses = {
        "–ø—Ä–∏–≤–µ—Ç": "–ò —Ç–µ–±–µ –ø—Ä–∏–≤–µ—Ç! üòä",
        "–∫–∞–∫ –¥–µ–ª–∞": "–û—Ç–ª–∏—á–Ω–æ! –ì–æ—Ç–æ–≤ –ø–æ–º–æ–≥–∞—Ç—å —Å –∏–≥—Ä–∞–º–∏ –∏ –¥–µ–ª–∞–º–∏! üéÆ",
        "—á—Ç–æ –¥–µ–ª–∞–µ—à—å": "–ñ–¥—É —Ç–≤–æ–∏—Ö –∫–æ–º–∞–Ω–¥!",
        "—Å–ø–∞—Å–∏–±–æ": "–í—Å–µ–≥–¥–∞ —Ä–∞–¥ –ø–æ–º–æ—á—å! üëç",
        "–ø–æ–∫–∞": "–î–æ –≤—Å—Ç—Ä–µ—á–∏! üëã",
        "–±–æ—Ç": "–î–∞, —è —Ç—É—Ç! –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?",
        "–∏–≥—Ä–∞": "–û—Ç–ª–∏—á–Ω–∞—è —Ç–µ–º–∞! –õ—é–±–ª—é –∏–≥—Ä—ã! üéÆ",
    }
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –≥–æ—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç
    lower_message = user_message.lower()
    for key in responses:
        if key in lower_message:
            await update.message.reply_text(responses[key])
            return
    
    # –ï—Å–ª–∏ —ç—Ç–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
    if "—Ö–æ—á—É —Ñ—É–Ω–∫—Ü–∏—é" in lower_message or "–¥–æ–±–∞–≤—å —Ñ—É–Ω–∫—Ü–∏—é" in lower_message:
        await update.message.reply_text("–ó–∞–ø–∏—Å–∞–ª —Ç–≤–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ! ‚úçÔ∏è")
        return
    
    # –ï—Å–ª–∏ –Ω–µ—Ç –≥–æ—Ç–æ–≤–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ - –ø—Ä–æ—Å—Ç–æ –ø–æ–≤—Ç–æ—Ä—è–µ–º
    reply_text = f"üìù –í—ã –Ω–∞–ø–∏—Å–∞–ª–∏: \"{user_message}\""
    await update.message.reply_text(reply_text)

# ============================================
# –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ò –ó–ê–ü–£–°–ö
# ============================================

def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –±–æ—Ç–∞ - –¥–ª—è Bothost"""
    
    logger.info("=" * 50)
    logger.info("ü§ñ –ó–ê–ü–£–°–ö –¢–ï–õ–ï–ì–†–ê–ú –ë–û–¢–ê")
    logger.info("=" * 50)
    
    # –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω
    TOKEN = get_bot_token()
    
    if not TOKEN:
        logger.error("‚ùå –¢–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.")
        print("=" * 50)
        print("‚ùå –û–®–ò–ë–ö–ê: –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω!")
        print("=" * 50)
        print("–î–ª—è Bothost: –¥–æ–±–∞–≤—å—Ç–µ BOT_TOKEN –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è")
        print("–î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞: —Å–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª token.txt —Å —Ç–æ–∫–µ–Ω–æ–º")
        print("=" * 50)
        return None
    
    logger.info(f"‚úÖ –¢–æ–∫–µ–Ω –ø–æ–ª—É—á–µ–Ω (–¥–ª–∏–Ω–∞: {len(TOKEN)})")
    
    try:
        # –°–æ–∑–¥–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
        app = Application.builder().token(TOKEN).build()
        
        # –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥
        handlers = [
            ("start", start_command),
            ("hello", hello_command),
            ("help", help_command),
            ("info", info_command),
            ("games", games_command),
        ]
        
        for command, handler in handlers:
            app.add_handler(CommandHandler(command, handler))
            logger.info(f"‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ /{command}")
        
        # –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –æ–±—ã—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
        app.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, echo_message))
        logger.info("‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ–±—ã—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π")
        
        logger.info("=" * 50)
        logger.info("‚úÖ –ë–æ—Ç —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!")
        logger.info("=" * 50)
        
        return app
        
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –±–æ—Ç–∞: {e}")
        return None

# ============================================
# –¢–û–ß–ö–ê –í–•–û–î–ê –î–õ–Ø BOTHOST
# ============================================
# Bothost –∏—â–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é main() –∏ –≤—ã–∑—ã–≤–∞–µ—Ç –µ—ë
# –û–Ω —Ç–∞–∫–∂–µ –¥–æ–ª–∂–µ–Ω –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

# ============================================
# –¢–û–ß–ö–ê –í–•–û–î–ê –î–õ–Ø –õ–û–ö–ê–õ–¨–ù–û–ì–û –ó–ê–ü–£–°–ö–ê
# ============================================
if __name__ == "__main__":
    """–ó–∞–ø—É—Å–∫ –ø—Ä–∏ –ª–æ–∫–∞–ª—å–Ω–æ–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏"""
    
    print("=" * 50)
    print("üîß –õ–û–ö–ê–õ–¨–ù–´–ô –ó–ê–ü–£–°–ö –ë–û–¢–ê")
    print("=" * 50)
    
    # –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
    TOKEN = get_bot_token()
    
    if not TOKEN:
        print("‚ùå –¢–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω!")
        print("–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª 'token.txt' —Å –≤–∞—à–∏–º —Ç–æ–∫–µ–Ω–æ–º –æ—Ç @BotFather")
        print("–ò–ª–∏ –∑–∞–º–µ–Ω–∏—Ç–µ '–í–ê–®_–¢–û–ö–ï–ù_–ó–î–ï–°–¨' –≤ –∫–æ–¥–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω")
        print("=" * 50)
        exit(1)
    
    print(f"‚úÖ –¢–æ–∫–µ–Ω –ø–æ–ª—É—á–µ–Ω")
    print("‚úÖ –ó–∞–ø—É—Å–∫–∞—é –±–æ—Ç–∞...")
    print("‚úÖ –û—Ç–∫—Ä–æ–π—Ç–µ Telegram –∏ –Ω–∞–ø–∏—à–∏—Ç–µ –±–æ—Ç—É /start")
    print("‚úÖ –î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏: Ctrl+C")
    print("=" * 50)
    
    try:
        # –°–æ–∑–¥–∞–µ–º –∏ –∑–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞
        app = Application.builder().token(TOKEN).build()
        
        # –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
        app.add_handler(CommandHandler("start", start_command))
        app.add_handler(CommandHandler("hello", hello_command))
        app.add_handler(CommandHandler("help", help_command))
        app.add_handler(CommandHandler("info", info_command))
        app.add_handler(CommandHandler("games", games_command))
        app.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, echo_message))
        
        # –ó–∞–ø—É—Å–∫–∞–µ–º polling
        app.run_polling()
        
    except KeyboardInterrupt:
        print("\nüõë –ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º")
    except Exception as e:
        print(f"\n‚ùå –û—à–∏–±–∫–∞: {e}")